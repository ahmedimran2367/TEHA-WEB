<div fxLayoutAlign="start" class="tableHeight font-resp m-t-2" fxHide.lt-md="true">
  <table class="grid-table table-align table-resp table-align" mat-table matSort aria-label="Elements">
    <ng-container matColumnDef="tehaLgNo">
      <th class="sort" mat-header-cell *matHeaderCellDef mat-sort-header>
        {{'stockOverview.tehaLgNo' | translate}}
      </th>
      <td class="sort align-c" mat-cell *matCellDef="let element">
        <a class="link" (click)="onPropertyClick(element.id)">{{ element.tehaLgNo | replaceNullWithDash}}</a>
      </td>
    </ng-container>

    <ng-container matColumnDef="adminLgNo">
      <th class="sort-x" mat-header-cell *matHeaderCellDef mat-sort-header>
            {{'stockOverview.adminLgNo' | translate}}
      </th>
      <td class="sort align-c" mat-cell *matCellDef="let element">
        <a class="link" (click)="onPropertyClick(element.id)">{{ element.adminLgNo | replaceNullWithDash}}</a>
      </td>
    </ng-container>

    <ng-container matColumnDef="address">
      <th mat-header-cell *matHeaderCellDef class="align-c">
        {{'stockOverview.address' | translate}}
      </th>
      <td class="align-s" mat-cell *matCellDef="let element">{{ element.street }}, {{ element.postcode }}
        {{element.place}}</td>

    </ng-container>

    <ng-container matColumnDef="rwm">
      <th mat-header-cell *matHeaderCellDef>
        <span fxLayout="row">
          <span class="m-l-4" fxFlex="70">{{'stockOverview.rwmStatus' | translate}}</span>
          <div fxFlexAlign="end" [matMenuTriggerFor]="filterMenu" [matMenuTriggerData]="{element: 'rwmStatus'}">
            <svg fxFlex *ngIf="!selectedFilter.has('rwmStatus');else filledFilterIcon" width="15" height="15"
              viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd"
                d="M18.3334 2.5H1.66675L8.33342 10.3833V15.8333L11.6667 17.5V10.3833L18.3334 2.5V2.5Z" stroke="#565656"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </div>
        </span>
      </th>
      <td mat-cell *matCellDef="let element" class="align-c primaryHighlight">
        <ng-container *ngIf="element.rwmStatus === 'Out of Order' || element.rwmStatus === 'Error'; else elseTemplate">
          <span class="warning-color">{{'lookup.'+utilityService.toCamelCase(element.rwmStatus) | translate |
            replaceNullWithDash}}</span>
        </ng-container>
        <ng-template #elseTemplate>
          <span color="primary-color"> {{'lookup.'+utilityService.toCamelCase(element.rwmStatus) | translate |
            replaceNullWithDash}}</span>

        </ng-template>

      </td>

    </ng-container>

    <ng-container matColumnDef="accPeriod">
      <th mat-header-cell *matHeaderCellDef>
        <span fxLayout="row">
          <span class="m-l-4" fxFlex="70">{{'stockOverview.accountingPeriod' | translate}}</span>
          <div fxFlexAlign="end" [matMenuTriggerFor]="filterMenu" [matMenuTriggerData]="{element: 'monthMenu'}">
            <svg *ngIf="!selectedFilter.has('monthMenu');else filledFilterIcon" width="15" height="15"
              viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd"
                d="M18.3334 2.5H1.66675L8.33342 10.3833V15.8333L11.6667 17.5V10.3833L18.3334 2.5V2.5Z" stroke="#565656"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </div>
        </span>
      </th>
      <td class="align-c" mat-cell *matCellDef="let element">{{ element.billingPeriod }}</td>

    </ng-container>

    <ng-container matColumnDef="accStatus">
      <th mat-header-cell *matHeaderCellDef>
        <span fxLayout="row">
          <span class="m-l-4" fxFlex="70">{{'stockOverview.accountingStatus' | translate}}</span>
          <div fxFlexAlign="end" mat-icon-button [matMenuTriggerFor]="filterMenu"
            [matMenuTriggerData]="{element: 'accountingStatus'}">
            <svg *ngIf="!selectedFilter.has('accountingStatus');else filledFilterIcon" width="15" height="15"
              viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd"
                d="M18.3334 2.5H1.66675L8.33342 10.3833V15.8333L11.6667 17.5V10.3833L18.3334 2.5V2.5Z" stroke="#565656"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </div>
        </span>
      </th>
      <td class="align-c filter-pad" mat-cell *matCellDef="let element">
        {{'lookup.'+utilityService.toCamelCase(element.billingStatus) | translate}}
      </td>

    </ng-container>

    <ng-container matColumnDef="readingStatus">
      <th mat-header-cell *matHeaderCellDef>
        <span fxLayout="row">
          <span class="m-l-4" fxFlex="70">{{'stockOverview.readingStatus' | translate}}</span>
          <div fxFlexAlign="end" [matMenuTriggerFor]="filterMenu" [matMenuTriggerData]="{element: 'readingStatus'}">
            <svg *ngIf="!selectedFilter.has('readingStatus');else filledFilterIcon" width="15" height="15"
              viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd"
                d="M18.3334 2.5H1.66675L8.33342 10.3833V15.8333L11.6667 17.5V10.3833L18.3334 2.5V2.5Z" stroke="#565656"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </div>
        </span>
      </th>
      <td class="align-c filter-pad" mat-cell *matCellDef="let element">
        <span customToolTip [contentTemplate]="template">{{'lookup.'+utilityService.toCamelCase(element.readingStatus) |
          translate}}</span>
        <ng-template #elseReadingStatusTemplate>
          <span>{{'lookup.'+utilityService.toCamelCase(element.readingStatus) | translate}}</span>
        </ng-template>
        <ng-template #template>
          <div style="display: flex; flex-direction: column;">
            <div class="customTooltipFlatGroup" fxFlex fxLayout="column" fxLayoutGap="2px" fxLayoutAlign="center"
              *ngFor="let reading of element.readings; let l = count">
              <span class="hint-head" *ngIf="reading.flatgroupDesc!==null">{{reading.flatgroupDesc}}</span>
              <span class="hint-txt">{{'lookup.'+utilityService.toCamelCase(reading.type) | translate}} {{'stockOverview.readingPlannedOn' | translate}} {{reading.taskDate | date : 'dd/MM/yyyy'}}</span>
              <span class="hint-txt">{{reading.initHour}} {{reading.endHour!==null?'-':''}} {{reading.endHour}} Uhr</span>
            </div>
          </div>
        </ng-template>
      </td>

    </ng-container>

    <ng-container matColumnDef="plumbingStatus">
      <th mat-header-cell *matHeaderCellDef>
        <span fxLayout="row">
          <span class="m-l-4" fxFlex="70">{{'stockOverview.plumbingStatus' | translate}}</span>
          <div fxFlexAlign="end" mat-icon-button [matMenuTriggerFor]="filterMenu"
            [matMenuTriggerData]="{element: 'plumbingStatus'}">
            <svg *ngIf="!selectedFilter.has('plumbingStatus');else filledFilterIcon" width="15" height="15"
              viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd"
                d="M18.3334 2.5H1.66675L8.33342 10.3833V15.8333L11.6667 17.5V10.3833L18.3334 2.5V2.5Z" stroke="#565656"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </div>
        </span>
      </th>
      <td class="align-c filter-pad" mat-cell *matCellDef="let element">
        <span *ngIf="element.assemblyStatus === 'PLAN' && element.plumbings;else elseAssemblyStatusTemplate"
          customToolTip
          [contentTemplate]="assemblyTooltipTemplate">{{'lookup.'+utilityService.toCamelCase(element.assemblyStatus) |
          translate}}</span>
        <ng-template #elseAssemblyStatusTemplate>
          <span *ngIf="element.assemblyStatus === 'ON_HOLD' ;else remainingAssemblyStatusTemplate"
            customToolTip [contentTemplate]="onHoldTooltipTemplate">{{'lookup.'+utilityService.toCamelCase(element.assemblyStatus) | translate}}</span>
          </ng-template>
          
          <ng-template #remainingAssemblyStatusTemplate>
          <span>{{'lookup.'+utilityService.toCamelCase(element.assemblyStatus) | translate}}</span>
        </ng-template>
        <ng-template #assemblyTooltipTemplate>
          <div style="display: flex; flex-direction: column;">
            <div class="customTooltipFlatGroup" fxFlex fxLayout="column" fxLayoutGap="2px" fxLayoutAlign="center"
              *ngFor="let plumbing of element.plumbings; let l = count">
              <span class="hint-head" *ngIf="plumbing.flatgroupDesc!==null">{{plumbing.flatgroupDesc}}</span>
              <span class="hint-txt">{{'stockOverview.plannedOn' | translate}} {{plumbing.taskDate | date : 'dd/MM/yyyy'}}</span>
              <span class="hint-txt">{{plumbing.initHour}} {{plumbing.endHour!==null?'-':''}} {{plumbing.endHour}} Uhr</span>
            </div>
          </div>
        </ng-template>
      </td>

    </ng-container>

    <ng-container matColumnDef="openLetter">
      <th class="w-1" mat-header-cell *matHeaderCellDef>
        {{'stockOverview.openLetter' | translate}}
      </th>
      <td class="align-c " mat-cell *matCellDef="let element">
        <ng-container *ngIf="element.openLetterInd; else disabledDownloadButtonTemplate">
          <button (click)="downloadOpenLetter(element.id, element.tehaLgNo)" mat-button>
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd"
                d="M5 5V2C5 0.89543 5.89543 0 7 0H13C14.1046 0 15 0.89543 15 2V5V9H20L10 17.5847L0 9H5V5ZM13 2V5V9V11H14.2967L10 14.9505L5.70326 11H7V9V5V2H13ZM17 20C18.1046 20 19 19.1046 19 18H1C1 19.1046 1.89543 20 3 20H17Z"
                fill="#565656" />
            </svg>
          </button>
        </ng-container>
      </td>

    </ng-container>

    <ng-container matColumnDef="createAnOrder">
      <th mat-header-cell *matHeaderCellDef>
        {{'stockOverview.createOrder' | translate}}
      </th>
      <td class="align-c" mat-cell *matCellDef="let element" (contextmenu)="onContextMenu($event, element)">
        <button mat-button [matMenuTriggerFor]="appMenu" [matMenuTriggerData]="{element: element}"
          class="btn text-blue">
          <span class="drop-btn-pad">{{'stockOverview.select' | translate}}</span>
          <mat-icon>keyboard_arrow_down</mat-icon>

        </button>
      </td>

    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

  </table>
</div>


<!-- <div fxLayout="column" fxFlexFill fxLayoutAlign="center center" fxHide.lt-md="true">
  <mat-paginator hidePageSize="true" #paginator (page)="onPageChange($event)" [pageIndex]="pageIndex"
    [pageSize]="pageSize">
  </mat-paginator>
</div> -->

<ng-template #disabledDownloadButtonTemplate>
  <span><img src="./assets/images/download-dis.svg"></span>
</ng-template>

<!-- ----------------------mobile view------------------- -->
<div class="mat-mobile-resp" fxLayout="column" fxLayoutAlign="start center" fxHide.gt-sm="true" fxLayoutGap="20px"
  *ngIf="dataSource" class="font-resp">
  <mat-card fxFlex fxHide.gt-sm="true" class="mat-dashboard-card w-100" fxLayout="column" fxLayoutGap="20px"
    *ngFor="let item of dataSource.data">
    <div fxLayout="column" fxLayoutGap="10px">
      <div fxLayout="row" fxLayoutAlign="space-between start" fxLayoutGap="20px">
        <div fxFlex fxLayout="column">
          <span fxFlex="50" class="support-text-b">{{item.street}}</span>
        </div>
        <div fxFlex fxLayout="column">
          <span fxFlex="50" class="support-text-b">{{'stockOverview.tehaLgNo' | translate}}: <span
              class="support-text">{{item.tehaLgNo}}</span></span>
          <span fxFlex="50" class="support-text-b">{{'stockOverview.adminLgNo' | translate}}: <span
              class="support-text-b">{{item.adminLgNo}}</span></span>
        </div>
      </div>
      <mat-divider [inset]="true">
      </mat-divider>
      <div fxLayout="row" fxLayoutGap="20px" fxLayoutAlign="center start">
        <div fxFlex="50" fxLayout="row" fxLayoutGap="10px">
          <div fxFlex="52px" fxFlexAlign="center">
            <img src="./assets/images/Smoke.svg" width="42" height="42" viewBox="0 0 42 42">
          </div>
          <div fxLayout="column" fxLayoutAlign="center center">
            <span class="support-text-b word-break">{{'stockOverview.rwmStatus' | translate}}: </span>
            <span class="support-text word-break">{{'lookup.'+utilityService.toCamelCase(item.rwmStatus) | translate | replaceNullWithDash}}</span>
          </div>
        </div>

        <div fxFlex="50" fxLayout="row" fxLayoutGap="10px">
          <div fxFlex="52px" fxFlexAlign="center">
            <img src="./assets/images/Reading.svg" width="42" height="42" viewBox="0 0 42 42">
          </div>
          <div fxLayout="column" fxLayoutAlign="center start">
            <span class="support-text-b word-break">{{'stockOverview.readingStatus' | translate}}: </span>
            <span class="support-text word-break">{{'lookup.'+utilityService.toCamelCase(item.readingStatus) |
              translate}}</span>
          </div>
        </div>
      </div>
      <div fxLayout="row" fxLayoutGap="20px" fxLayoutAlign="center start">
        <div fxFlex="50" fxLayout="row" fxLayoutGap="10px">
          <div fxFlex="52px" fxFlexAlign="center">
            <img src="./assets/images/plumber.svg" width="42" height="42" viewBox="0 0 42 42">
          </div>
          <div class="acc-period" fxLayout="column" fxLayoutAlign="center start">
            <span class="support-text-b word-break">{{'stockOverview.plumbingStatus' | translate}}: </span>
            <span class="support-text word-break">{{'lookup.'+utilityService.toCamelCase(item.assemblyStatus) |
              translate}}</span>
          </div>
        </div>
        <div fxFlex="50" fxLayout="row" fxLayoutGap="10px">
          <div fxFlex="52px" fxFlexAlign="center">
            <img src="./assets/images/Reading.svg" width="42" height="42" viewBox="0 0 42 42">
          </div>
          <div fxLayout="column" fxLayoutAlign="center start">
            <span class="support-text-b word-break">{{'stockOverview.accountingStatus' | translate}}: </span>
            <span class="support-text word-break"> {{'lookup.'+utilityService.toCamelCase(item.billingStatus) | translate}}</span>
          </div>
        </div>
      </div>
      <div fxLayout="row" fxLayoutGap="20px" fxLayoutAlign="center start">
        <div fxFlex="100" fxLayout="row" fxLayoutGap="10px">
          <div fxFlex="52px" fxFlexAlign="center">
            <img src="./assets/images/calendar.svg" width="42" height="42" viewBox="0 0 42 42">
          </div>
          <div fxLayout="column" fxLayoutAlign="center start">
            <span class="support-text-b word-break">{{'stockOverview.accountingPeriod' | translate}}: </span>
            <span class="support-text word-break">{{ item.billingPeriod }}</span>
          </div>
        </div>
      </div>


      <mat-divider [inset]="true">
      </mat-divider>
      <div fxLayout="row" fxLayoutGap="20px" fxLayoutAlign="space-between start">

        <div fxFlex fxLayout="row" fxLayoutAlign="start center">
          <span class="support-text-b">{{'stockOverview.openLetter' | translate}}: </span>
          <span class="support-text">
            <button *ngIf="item.openLetterInd; else disabledDownloadButtonTemplate" (click)="downloadOpenLetter(item.id, item.tehaLgNo)" mat-button>
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M5 5V2C5 0.89543 5.89543 0 7 0H13C14.1046 0 15 0.89543 15 2V5V9H20L10 17.5847L0 9H5V5ZM13 2V5V9V11H14.2967L10 14.9505L5.70326 11H7V9V5V2H13ZM17 20C18.1046 20 19 19.1046 19 18H1C1 19.1046 1.89543 20 3 20H17Z"
                  fill="#565656" />
              </svg>
            </button>

          </span>
          <span  fxFlex fxLayoutAlign="end">
            <button  class="forward1" (click)="onPropertyClick(item.id)" mat-icon-button color="primary">
              <mat-icon>forward</mat-icon>
            </button>
          </span>
        </div>
      </div>
    </div>
  </mat-card>
</div>

<mat-card ngClass.gt-sm="p-0 shadow-none" ngClass.lt-md="p-0 m-t-4 m-b-4">
  <div fxLayout="column" fxLayoutAlign="center center" >
    <mat-paginator hidePageSize="true" #paginator (page)="onPageChange($event)" [pageIndex]="pageIndex"
      [pageSize]="pageSize">
    </mat-paginator>
  </div>
</mat-card>

<ng-template #onHoldTooltipTemplate>
  <div class="on-hold-tooltip" fxLayout="row" fxLayoutGap="2px" fxLayoutAlign="center">
    <span class="hint-txt">{{'stockOverview.onHoldTooltip' | translate}}</span>
  </div>
</ng-template>

<mat-menu #appMenu="matMenu" class="comp-mat-menu">
  <ng-template matMenuContent let-element="element">
    <button (click)="onOrdersClick('energyPerformance', element.id)" mat-menu-item>{{'order.energyPerformance' |
      translate}}</button>
    <mat-divider></mat-divider>
    <button (click)="onOrdersClick('drinkingWater', element.id)" mat-menu-item>{{'order.drinkingWater' |
      translate}}</button>
    <mat-divider></mat-divider>
    <button (click)="onOrdersClick('orderReading', element.id)" mat-menu-item>{{'order.orderReading' |
      translate}}</button>
  </ng-template>
</mat-menu>


<mat-menu class="menuFilter scrollbar" #filterMenu="matMenu">
  <ng-template matMenuContent let-element="element">
    <div *ngIf="selectedFilter.has(element)">
      <button (click)="removeFilter(element)" mat-button>{{'accounting.reset' | translate}}</button>
      <mat-divider></mat-divider>
    </div>
    <mat-selection-list *ngIf="element === 'readingStatus'; else commonFilterTemplate"
      (click)="$event.stopPropagation()" #filters [(ngModel)]="this.propertyRequest.readingStatus">
      <mat-list-option *ngFor="let item of getFilterList(element)" (click)="onFilterClick(element, item)"
        [value]="item.code">
        {{'lookup.'+utilityService.toCamelCase(item.code) | translate}}
      </mat-list-option>
    </mat-selection-list>

    <!-- Common filter menu for other filters except Reading Status -->
    <ng-template #commonFilterTemplate>
      <div *ngFor="let item of getFilterList(element);let i=index; let l= count">
        <div class="menu-button">
          <button mat-menu-item (click)="onFilterClick(element, item)"><span
              [ngClass]="{'text-darkgreen': setColor(element, item)}">
              {{element === 'monthMenu'? item : 'lookup.'+utilityService.toCamelCase(item.code ) | translate}}
            </span>
          </button>
          <mat-divider *ngIf="i!==l-1"></mat-divider>
        </div>
      </div>
    </ng-template>

  </ng-template>
</mat-menu>


<ng-template #filledFilterIcon>
  <mat-icon class="selected-filter-icon">filter_alt</mat-icon>
</ng-template>